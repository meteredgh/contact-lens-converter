<!DOCTYPE html>
<html lang="en">
<head>
<!-- PWA Meta Tags -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#000000">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192x192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="CL Converter">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192x192.png">
  <meta charset="UTF-8">
  <title>Spectacles To Contact Lens Converter</title>
  <meta name="keywords" content="contact lens script converter, spectacle to contact lens conversion, vertex distance calculator, cylinder conversion for contact lenses, online contact lens formula tool, spherical equivalent calculator, axis rounding for contact lenses, offline contact lens converter, toric lens prescription tool, eyecare professional tool, optometry calculator, glasses to contacts conversion, contact lens vertex formula, contact lens sph cyl axis converter">
  <meta name="description" content="An offline contact lens prescription converter that calculates contact lens power from spectacle scripts using vertex distance, cylinder conversion, and axis rounding. Ideal for optometrists and eyecare professionals.">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .input-section, .result-section {
      flex: 1;
      overflow-y: auto;
      padding-right: 20px;
    }

    .result-section {
      padding-left: 20px;
      border-left: 1px solid #ccc;
    }

    .input-group {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }

    .radio-group {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
      gap: 15px;
    }

    label {
      width: 120px;
      font-weight: bold;
    }

    input[type="radio"] {
      margin-right: 5px;
    }

    input[type="number"] {
      width: 80px;
      padding: 5px;
      margin-right: 10px;
    }

    .result-line {
      display: inline-block;
      padding: 4px 6px;
      margin-left: 10px;
      border-radius: 4px;
      font-weight: bold;
      min-width: 120px;
    }

    .result-container {
      margin-left: 10px;
    }

    .buttons {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
    }

    button {
      padding: 10px 20px;
      margin-left: 10px;
    }

    .disclaimer {
      margin-top: 30px;
      color: #555;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="header">
    <h2>Spectacles To Contact Lens Converter</h2>
    <button onclick="resetForm()">Reset</button>
  </div>

  <div class="main">
    <!-- Input Section -->
    <div class="input-section">
      <!-- Settings -->

      <div class="radio-group">
        <label>Vertex Distance:</label>
        <label><input type="radio" name="vertexDistance" value="10" onchange="convertPrescription()">10 mm</label>
        <label><input type="radio" name="vertexDistance" value="12" checked onchange="convertPrescription()">12 mm</label>
        <label><input type="radio" name="vertexDistance" value="14" onchange="convertPrescription()">14 mm</label>
      </div>

      <!-- Right Eye (OD) -->
      <h3>Right Eye (OD)</h3>
      <div class="input-group">
        <label for="sphOD">Sphere:</label>
        <input type="number" step="0.25" id="sphOD" placeholder="0.00">
        <div class="result-container" id="resultOD_sph"></div>
      </div>
      <div class="input-group">
        <label for="cylOD">Cylinder:</label>
        <input type="number" step="0.25" id="cylOD" placeholder="0.00">
        <div class="result-container" id="resultOD_cyl"></div>
      </div>
      <div class="input-group">
        <label for="axisOD">Axis:</label>
        <input type="number" id="axisOD" placeholder="180">
        <div class="result-container" id="resultOD_axis"></div>
      </div>

      <!-- Left Eye (OS) -->
      <h3>Left Eye (OS)</h3>
      <div class="input-group">
        <label for="sphOS">Sphere:</label>
        <input type="number" step="0.25" id="sphOS" placeholder="0.00">
        <div class="result-container" id="resultOS_sph"></div>
      </div>
      <div class="input-group">
        <label for="cylOS">Cylinder:</label>
        <input type="number" step="0.25" id="cylOS" placeholder="0.00">
        <div class="result-container" id="resultOS_cyl"></div>
      </div>
      <div class="input-group">
        <label for="axisOS">Axis:</label>
        <input type="number" id="axisOS" placeholder="180">
        <div class="result-container" id="resultOS_axis"></div>
      </div>
    </div>

    <!-- Live Results Section -->
    <div class="result-section">
      <h3>Live Results</h3>
      <div id="liveResults" style="font-size: 16px;"></div>
    </div>
  </div>

  <div class="disclaimer">
    üåê By Optom. Akhtar <a href="https://www.instagram.com/crosscylinder/" target="_blank" style="text-decoration: none;">@crosscylinder</a> |
    Download this file from: <a href="http://tiny.cc/sp2cl" target="_blank" style="text-decoration: none;">tiny.cc/sp2cl</a>
| <a href="https://tinyurl.com/sp2clapp" style="text-decoration: none;">tinyurl.com/sp2clapp</a> </div>

  <script>
    function mround(value, multiple) {
      return Math.round(value / multiple) * multiple;
    }

    function convertPower(value, vertexDistance) {
      return ((value * value) * vertexDistance / 1000) + value;
    }

    function roundAxis(axis) {
      let rounded = mround(axis, 10);
      return rounded === 0 ? 180 : rounded;
    }

    function setResultColor(element, value) {
      element.style.backgroundColor = value > 0 ? "lightgreen" : value < 0 ? "lightcoral" : "white";
    }

    function clearResultContainers() {
      document.querySelectorAll(".result-container").forEach(el => el.innerHTML = "");
    }

    function getVertexDistance() {
      const selected = document.querySelector('input[name="vertexDistance"]:checked');
      return parseFloat(selected.value);
    }

    function convertPrescription() {
      clearResultContainers();

      // Get selected vertex distance
      const vertexDistance = getVertexDistance();

      // Clear live results
      const liveResults = document.getElementById("liveResults");
      liveResults.innerHTML = "";

      // Create a container for formatted results
      const resultsBox = document.createElement("div");
      resultsBox.style.lineHeight = "1.6";
      resultsBox.style.padding = "10px";
      resultsBox.style.border = "1px solid #ddd";
      resultsBox.style.borderRadius = "6px";
      resultsBox.style.backgroundColor = "#f9f9f9";

      // Right Eye (OD)
      const sphOD = parseFloat(document.getElementById("sphOD").value) || 0;
      const cylOD = parseFloat(document.getElementById("cylOD").value) || 0;
      const axisOD = parseFloat(document.getElementById("axisOD").value) || 0;

      const d4OD = sphOD + cylOD;
      const d7OD = convertPower(sphOD, vertexDistance);
      const d14OD = convertPower(d4OD, vertexDistance);
      const d9OD = d14OD - d7OD;
      const convertedCylOD = mround(d9OD, 0.25);
      const convertedSphOD = mround(d7OD, 0.25);
      const roundedAxisOD = roundAxis(axisOD);

      // Display OD Inline Results
      const sphODResult = document.createElement("span");
      sphODResult.className = "result-line";
      sphODResult.textContent = `SPH: ${convertedSphOD.toFixed(2)} D`;
      setResultColor(sphODResult, convertedSphOD);
      document.getElementById("resultOD_sph").appendChild(sphODResult);

      const cylODResult = document.createElement("span");
      cylODResult.className = "result-line";
      cylODResult.textContent = `CYL: ${convertedCylOD.toFixed(2)} D`;
      setResultColor(cylODResult, convertedCylOD);
      document.getElementById("resultOD_cyl").appendChild(cylODResult);

      const axisODResult = document.createElement("span");
      axisODResult.className = "result-line";
      axisODResult.textContent = `Axis: ${roundedAxisOD}`;
      document.getElementById("resultOD_axis").appendChild(axisODResult);

      // Left Eye (OS)
      const sphOS = parseFloat(document.getElementById("sphOS").value) || 0;
      const cylOS = parseFloat(document.getElementById("cylOS").value) || 0;
      const axisOS = parseFloat(document.getElementById("axisOS").value) || 0;

      const d4OS = sphOS + cylOS;
      const d7OS = convertPower(sphOS, vertexDistance);
      const d14OS = convertPower(d4OS, vertexDistance);
      const d9OS = d14OS - d7OS;
      const convertedCylOS = mround(d9OS, 0.25);
      const convertedSphOS = mround(d7OS, 0.25);
      const roundedAxisOS = roundAxis(axisOS);

      // Display OS Inline Results
      const sphOSResult = document.createElement("span");
      sphOSResult.className = "result-line";
      sphOSResult.textContent = `SPH: ${convertedSphOS.toFixed(2)} D`;
      setResultColor(sphOSResult, convertedSphOS);
      document.getElementById("resultOS_sph").appendChild(sphOSResult);

      const cylOSResult = document.createElement("span");
      cylOSResult.className = "result-line";
      cylOSResult.textContent = `CYL: ${convertedCylOS.toFixed(2)} D`;
      setResultColor(cylOSResult, convertedCylOS);
      document.getElementById("resultOS_cyl").appendChild(cylOSResult);

      const axisOSResult = document.createElement("span");
      axisOSResult.className = "result-line";
      axisOSResult.textContent = `Axis: ${roundedAxisOS}`;
      document.getElementById("resultOS_axis").appendChild(axisOSResult);

      // Build Live Results Output
      const output = `
        <div id="resultsText">
          <div><strong>Right Eye (OD)</strong><br>
            SPH: ${convertedSphOD.toFixed(2)} D | CYL: ${convertedCylOD.toFixed(2)} D | Axis: ${roundedAxisOD}
          </div>
          <div style="margin-top: 15px;"><strong>Left Eye (OS)</strong><br>
            SPH: ${convertedSphOS.toFixed(2)} D | CYL: ${convertedCylOS.toFixed(2)} D | Axis: ${roundedAxisOS}
          </div>
        </div>
        <div style="margin-top: 20px;">
          <button onclick="copyResults()" class="buttons">Copy Results</button>
        </div>
      `;
      resultsBox.innerHTML = output;
      liveResults.appendChild(resultsBox);
    }

    function copyResults() {
      const resultsText = document.getElementById("resultsText");
      if (!resultsText) {
        alert("No results to copy!");
        return;
      }

      const textToCopy = resultsText.textContent.trim();
      navigator.clipboard.writeText(textToCopy).then(() => {
        alert("Results copied to clipboard!");
      }).catch(err => {
        console.error("Failed to copy: ", err);
      });
    }

    function resetForm() {
      document.querySelector('input[name="vertexDistance"][value="12"]').checked = true;
      document.getElementById("sphOD").value = "";
      document.getElementById("cylOD").value = "";
      document.getElementById("axisOD").value = "";
      document.getElementById("sphOS").value = "";
      document.getElementById("cylOS").value = "";
      document.getElementById("axisOS").value = "";
      clearResultContainers();
      document.getElementById("liveResults").innerHTML = "";
    }

    // Initialize live updates and keyboard navigation
    document.addEventListener("DOMContentLoaded", () => {
      const inputs = document.querySelectorAll("input[type='number']");

      // Live update on input
      inputs.forEach(input => {
        input.addEventListener("input", convertPrescription);
      });

      // Press Enter to go to next field
      inputs.forEach((input, index) => {
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            const nextIndex = (index + 1) % inputs.length;
            inputs[nextIndex].focus();
          }
        });
      });

      // Radio buttons already trigger convertPrescription via onchange
    });
  </script>
<script>
  // Service Worker registration
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
      .then(registration => console.log('Service Worker registered'))
      .catch(error => console.log('SW registration failed:', error));
  }

  // Install prompt (optional)
  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    showInstallPromotion();
  });

  function showInstallPromotion() {
    const installBtn = document.createElement("button");
    installBtn.textContent = "Install Contact Lens Converter";
    installBtn.style.position = "fixed";
    installBtn.style.bottom = "20px";
    installBtn.style.right = "20px";
    installBtn.style.zIndex = "1000";
    installBtn.onclick = async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') deferredPrompt = null;
      }
    };
    document.body.appendChild(installBtn);
  }
</script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
      .then(registration => console.log('Service Worker registered'))
      .catch(error => console.log('SW registration failed:', error));
  }
</script>
<script>
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  showInstallPromotion();
});

function showInstallPromotion() {
  const installBtn = document.createElement("button");
  installBtn.textContent = "Install Contact Lens Converter";
  installBtn.style.position = "fixed";
  installBtn.style.bottom = "20px";
  installBtn.style.right = "20px";
  installBtn.style.zIndex = "1000";
  installBtn.onclick = async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') deferredPrompt = null;
    }
  };
  document.body.appendChild(installBtn);
}
</script>
</body>
</html>
